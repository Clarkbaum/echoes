'use strict';

var express = require('express');
var router = express.Router();
var path = require('path');
var util = require('../utilities.js');
var knex = require('../../db/db.js');

// queries database and returns user's album entries
router.get('/', function (req, res) {
  // get username from the cookie
  var username = req.cookies.username;
  // find all listen instances by the user
<<<<<<< HEAD
  knex.from('users').join('album_impression', 'users.id', 'album_impression.user_id').where('users.username', username).join('album', 'album_impression.album_id', 'album.id').join('artist', 'artist.id', 'album.artist_id').join('listen_date', 'listen_date.album_impression_id', 'album_impression.id').select('users.user', 'listen_date.date', 'album.title', 'artist.name', 'album.genre', 'album.year', 'album_impression.rating', 'album_impression.impression', 'album_impression.id', 'album.art_url60', 'album.art_url100').orderBy('listen_date.date', 'desc').then(function (result) {
=======
  knex.from('user').join('album_impression', 'user.id', 'album_impression.user_id').where('user.username', username).join('album', 'album_impression.album_id', 'album.id').join('artist', 'artist.id', 'album.artist_id').join('listen_date', 'listen_date.album_impression_id', 'album_impression.id').select('user.user', 'listen_date.date', 'album.title', 'artist.name', 'album.genre', 'album.year', 'album_impression.rating', 'album_impression.impression', 'album_impression.id', 'album.art_url60', 'album.art_url100').orderBy('listen_date.date', 'desc').then(function (result) {
>>>>>>> eaaa83cea770bf33423ca0f7046d02accc21f4d1
    // send the result back to the user
    console.log(result);
    res.status(200).send(result);
  }).catch(function (err) {
    console.log('Problem grabbing user info');
  });
});

// post new album to the database
router.post('/', function (req, res) {
  var album = req.body.album;
  // put date into correct format for db
  var date = req.body.date.slice(0, 10);
  var username = req.cookies.username;
  // check if artist is in db
  knex('artist').where({ name: album.artistName }).select('id').then(function (artistId) {
    if (artistId.length) {
      var artistId = artistId[0].id;
      // check if the album is already in the database
      knex('album').select('id').where('title', album.collectionName).where('artist_id', artistId).then(function (albumId) {
        // if the album exists
        if (albumId.length) {
          var albumId = albumId[0].id;
          // check if the user has listened to it before
<<<<<<< HEAD
          knex('users').select('id').where('username', username).then(function (userId) {
=======
          knex('user').select('id').where('username', username).then(function (userId) {
>>>>>>> eaaa83cea770bf33423ca0f7046d02accc21f4d1
            var userId = userId[0].id;
            knex('album_impression').select('id').where('user_id', userId).where('album_id', albumId).then(function (impressId) {
              // if user has listened to album
              if (impressId.length) {
                var impressId = impressId[0].id;
                // Add a new listen date
                knex('listen_date').select('id').where('album_impression_id', impressId).where('date', date).then(function (listenId) {
                  if (listenId.length) {
                    res.status(400).send('You already listened to this album that day.');
                  } else {
                    knex('listen_date').insert({
                      date: date,
                      album_impression_id: impressId
                    }).then(function () {
                      res.status(201).send('Successful Post!');
                    }).catch(function (err) {
                      console.log('Problem with inserting listen_date #1');
                      throw err;
                    });
                  }
                }).catch(function (err) {
                  console.log('Problem with grabbing listenDateId #1');
                  throw err;
                });
                //if user has not listened to album
              } else {
                //add an album_impression for the user
                knex('album_impression').returning('id').insert({
                  user_id: userId,
                  album_id: albumId
                }).then(function (impressId) {
                  var impressId = impressId[0].id;
                  // add new listen date for album
                  knex('listen_date').insert({
                    'date': date,
                    'album_impression_id': impressId
                  }).then(function () {
                    res.status(201).send('Successful Post!');
                  }).catch(function (err) {
                    console.log('Problem with inserting listen_date #2');
                    throw err;
                  });
                }).catch(function (err) {
                  console.log('Problem with inserting album_impression #1');
                  throw err;
                });
              }
            }).catch(function (err) {
              console.log('Problem with grabbing album_impression_id #1');
              throw err;
            });
          }).catch(function (err) {
            console.log('Problem with grabbing albumId');
          });
          // if album does not exist
        } else {
          // insert album
          knex('album').returning('id').insert({
            title: album.collectionName,
            artist_id: artistId,
            genre: album.primaryGenreName,
            year: album.releaseDate.slice(0, 4),
            art_url60: album.artworkUrl60,
            art_url100: album.artworkUrl100
          }).then(function (albumId) {
            var albumId = albumId[0];
            // find user's id
<<<<<<< HEAD
            knex.from('users').select('id').where('username', username).then(function (userId) {
=======
            knex.from('user').select('id').where('username', username).then(function (userId) {
>>>>>>> eaaa83cea770bf33423ca0f7046d02accc21f4d1
              var userId = userId[0].id;
              // add album impression from user
              knex('album_impression').returning('id').insert({
                user_id: userId,
                album_id: albumId
              }).then(function (impressId) {
                var impressId = impressId[0].id;
                // add new listen date for album
                knex('listen_date').insert({
                  'date': date,
                  'album_impression_id': impressId }).then(function () {
                  res.status(201).send('Successful Post!');
                }).catch(function (err) {
                  console.log('Problem with inserting listen_date #3');
                  throw err;
                });
              }).catch(function (err) {
                console.log('Problem with inserting album_impression #2');
                throw err;
              });
            }).catch(function (err) {
              console.log('Problem with grabbing userId #2');
              throw err;
            });
          }).catch(function (err) {
            console.log('Problem with inserting album #1');
            throw err;
          });
        }
      }).catch(function (err) {
        console.log('Problem with grabbing albumId #1');
        throw err;
      });
    } else {
      // add artist to db
      knex('artist').returning('id').insert({ name: album.artistName }).then(function (artistId) {
        var artistId = artistId[0];
        console.log('artistId', artistId);
        // add album to db
        knex('album').returning('id').insert({
          title: album.collectionName,
          artist_id: artistId,
          genre: album.primaryGenreName,
          year: album.releaseDate.slice(0, 4),
          art_url60: album.artworkUrl60,
          art_url100: album.artworkUrl100
        }).then(function (albumId) {
          var albumId = albumId[0];
          // find user's id
<<<<<<< HEAD
          knex.from('users').select('id').where('username', username).then(function (userId) {
=======
          knex.from('user').select('id').where('username', username).then(function (userId) {
>>>>>>> eaaa83cea770bf33423ca0f7046d02accc21f4d1
            var userId = userId[0].id;
            // add album impression from user
            knex('album_impression').returning('id').insert({
              user_id: userId,
              album_id: albumId
            }).then(function (impressId) {
              var impressId = impressId[0];
              // add new listen date for album
              knex('listen_date').insert({ 'date': date,
                'album_impression_id': impressId }).then(function () {
                res.status(201).send('Successful Post!');
              }).catch(function (err) {
                console.log('Problem with inserting listen_date #4');
                throw err;
              });
            }).catch(function (err) {
              console.log('Problem with inserting album_impression #3');
              throw err;
            });
          }).catch(function (err) {
            console.log('Problem with selecting userId #3');
            throw err;
          });
        }).catch(function (err) {
          console.log('Problem with inserting album #2');
          throw err;
        });
      }).catch(function (err) {
        console.log('Problem with inserting artist #1');
        throw err;
      });;
    }
  }).catch(function (err) {
    console.log('Problem with grabbing artistId #1');
    throw err;
  });
});

// add/update impression
router.post('/update', function (req, res) {
  var impress = req.body;
  var id = Number(impress.id);
  var rating = Number(impress.rating);
  var impression = impress.impression;
  console.log('impress', impress);

  // if impression exists and rating doesn't
  if (impression && !rating) {
    knex('album_impression').where('id', impress.id)
    //update impression w/ req.body
    .update({
      impression: impression
    }).then(function () {
      res.status(201).end();
    });
    // if rating exists and impression doesn't
  } else if (rating && !impression) {
    knex('album_impression').where('id', impress.id)
    //update rating w/ req.body
    .update({
      rating: rating
    }).then(function () {
      res.status(201).end();
    });
    // if rating and impression exist
  } else if (rating && impression) {
    knex('album_impression').where('id', impress.id)
    //update impression and rating w/ req.body
    .update({
      impression: impress.impression,
      rating: impress.rating
    }).then(function () {
      res.status(201).end();
    });
    // if the user sent a blank save
  } else {
    // do nothing
    res.end();
  }
});

// remove listen_date
router.post('/delete', function (req, res) {
  var listenEntry = req.body;
  //find the listen_date Entry
  knex('listen_date')
  // check if there is more than 1 date for that impression_id
  .where('album_impression_id', listenEntry.impressionId).then(function (dates) {
    if (dates.length > 1) {
      // delete listen_date entry
      knex('listen_date').where('album_impression_id', listenEntry.impressionId).where('date', listenEntry.date).del().then(function () {
        res.status(201).send('Successfully removed album');
      });
      // if album_impress_id = 1
    } else {
      // delete album_impression
      knex('listen_date').where('album_impression_id', listenEntry.impressionId).where('date', listenEntry.date).del().then(function () {
        knex('album_impression').where('id', listenEntry.impressionId).del().then(function () {
          res.status(201).send('Successfully removed album');
        });
      });
    }
  });
});

module.exports = router;
<<<<<<< HEAD
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9yb3V0ZXMvZGJSb3V0ZXMuanMiXSwibmFtZXMiOlsiZXhwcmVzcyIsInJlcXVpcmUiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJwYXRoIiwidXRpbCIsImtuZXgiLCJnZXQiLCJyZXEiLCJyZXMiLCJ1c2VybmFtZSIsImNvb2tpZXMiLCJmcm9tIiwiam9pbiIsIndoZXJlIiwic2VsZWN0Iiwib3JkZXJCeSIsInRoZW4iLCJyZXN1bHQiLCJjb25zb2xlIiwibG9nIiwic3RhdHVzIiwic2VuZCIsImNhdGNoIiwiZXJyIiwicG9zdCIsImFsYnVtIiwiYm9keSIsImRhdGUiLCJzbGljZSIsIm5hbWUiLCJhcnRpc3ROYW1lIiwiYXJ0aXN0SWQiLCJsZW5ndGgiLCJpZCIsImNvbGxlY3Rpb25OYW1lIiwiYWxidW1JZCIsInVzZXJJZCIsImltcHJlc3NJZCIsImxpc3RlbklkIiwiaW5zZXJ0IiwiYWxidW1faW1wcmVzc2lvbl9pZCIsInJldHVybmluZyIsInVzZXJfaWQiLCJhbGJ1bV9pZCIsInRpdGxlIiwiYXJ0aXN0X2lkIiwiZ2VucmUiLCJwcmltYXJ5R2VucmVOYW1lIiwieWVhciIsInJlbGVhc2VEYXRlIiwiYXJ0X3VybDYwIiwiYXJ0d29ya1VybDYwIiwiYXJ0X3VybDEwMCIsImFydHdvcmtVcmwxMDAiLCJpbXByZXNzIiwiTnVtYmVyIiwicmF0aW5nIiwiaW1wcmVzc2lvbiIsInVwZGF0ZSIsImVuZCIsImxpc3RlbkVudHJ5IiwiaW1wcmVzc2lvbklkIiwiZGF0ZXMiLCJkZWwiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFVBQVVDLFFBQVEsU0FBUixDQUFkO0FBQ0EsSUFBSUMsU0FBU0YsUUFBUUcsTUFBUixFQUFiO0FBQ0EsSUFBSUMsT0FBT0gsUUFBUSxNQUFSLENBQVg7QUFDQSxJQUFJSSxPQUFPSixRQUFRLGlCQUFSLENBQVg7QUFDQSxJQUFJSyxPQUFPTCxRQUFRLGdCQUFSLENBQVg7O0FB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Q0FqQ0Q7O0FBbUNBMkMsT0FBT0MsT0FBUCxHQUFpQmhFLE1BQWpCIiwiZmlsZSI6ImRiUm91dGVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG52YXIgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMuanMnKTtcbnZhciBrbmV4ID0gcmVxdWlyZSgnLi4vLi4vZGIvZGIuanMnKTtcblxuLy8gcXVlcmllcyBkYXRhYmFzZSBhbmQgcmV0dXJucyB1c2VyJ3MgYWxidW0gZW50cmllc1xucm91dGVyLmdldCgnLycsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAvLyBnZXQgdXNlcm5hbWUgZnJvbSB0aGUgY29va2llXG4gIHZhciB1c2VybmFtZSA9IHJlcS5jb29raWVzLnVzZXJuYW1lO1xuICAvLyBmaW5kIGFsbCBsaXN0ZW4gaW5zdGFuY2VzIGJ5IHRoZSB1c2VyXG4gIGtuZXguZnJvbSgndXNlcnMnKVxuICAgICAgLmpvaW4oJ2FsYnVtX2ltcHJlc3Npb24nLCAndXNlcnMuaWQnLCAnYWxidW1faW1wcmVzc2lvbi51c2VyX2lkJylcbiAgICAgIC53aGVyZSgndXNlcnMudXNlcm5hbWUnLCB1c2VybmFtZSlcbiAgICAgIC5qb2luKCdhbGJ1bScsICdhbGJ1bV9pbXByZXNzaW9uLmFsYnVtX2lkJywgJ2FsYnVtLmlkJylcbiAgICAgIC5qb2luKCdhcnRpc3QnLCAnYXJ0aXN0LmlkJywgJ2FsYnVtLmFydGlzdF9pZCcpXG4gICAgICAuam9pbignbGlzdGVuX2RhdGUnLCAnbGlzdGVuX2RhdGUuYWxidW1faW1wcmVzc2lvbl9pZCcsICdhbGJ1bV9pbXByZXNzaW9uLmlkJylcbiAgICAgIC5zZWxlY3QoJ3VzZXJzLnVzZXInLFxuICAgICAgICAgICAgICAnbGlzdGVuX2RhdGUuZGF0ZScsXG4gICAgICAgICAgICAgICdhbGJ1bS50aXRsZScsICdhcnRpc3QubmFtZScsICdhbGJ1bS5nZW5yZScsICdhbGJ1bS55ZWFyJyxcbiAgICAgICAgICAgICAgJ2FsYnVtX2ltcHJlc3Npb24ucmF0aW5nJywgJ2FsYnVtX2ltcHJlc3Npb24uaW1wcmVzc2lvbicsICdhbGJ1bV9pbXByZXNzaW9uLmlkJyxcbiAgICAgICAgICAgICAgJ2FsYnVtLmFydF91cmw2MCcsICdhbGJ1bS5hcnRfdXJsMTAwJylcbiAgICAgIC5vcmRlckJ5KCdsaXN0ZW5fZGF0ZS5kYXRlJywgJ2Rlc2MnKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAvLyBzZW5kIHRoZSByZXN1bHQgYmFjayB0byB0aGUgdXNlclxuICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXN1bHQpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIGdyYWJiaW5nIHVzZXIgaW5mbycpO1xuICAgICAgfSlcbn0pO1xuXG4vLyBwb3N0IG5ldyBhbGJ1bSB0byB0aGUgZGF0YWJhc2VcbnJvdXRlci5wb3N0KCcvJywgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gIHZhciBhbGJ1bSA9IHJlcS5ib2R5LmFsYnVtO1xuICAvLyBwdXQgZGF0ZSBpbnRvIGNvcnJlY3QgZm9ybWF0IGZvciBkYlxuICB2YXIgZGF0ZSA9IHJlcS5ib2R5LmRhdGUuc2xpY2UoMCwgMTApO1xuICB2YXIgdXNlcm5hbWUgPSByZXEuY29va2llcy51c2VybmFtZTtcbiAgLy8gY2hlY2sgaWYgYXJ0aXN0IGlzIGluIGRiXG4gIGtuZXgoJ2FydGlzdCcpXG4gICAgLndoZXJlKHtuYW1lIDogYWxidW0uYXJ0aXN0TmFtZX0pXG4gICAgLnNlbGVjdCgnaWQnKVxuICAgIC50aGVuKGZ1bmN0aW9uKGFydGlzdElkKSB7XG4gICAgICBpZiAoYXJ0aXN0SWQubGVuZ3RoKSB7XG4gICAgICB2YXIgYXJ0aXN0SWQgPSBhcnRpc3RJZFswXS5pZDtcbiAgICAgIC8vIGNoZWNrIGlmIHRoZSBhbGJ1bSBpcyBhbHJlYWR5IGluIHRoZSBkYXRhYmFzZVxuICAgICAgICBrbmV4KCdhbGJ1bScpXG4gICAgICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgICAgIC53aGVyZSgndGl0bGUnLCBhbGJ1bS5jb2xsZWN0aW9uTmFtZSlcbiAgICAgICAgICAud2hlcmUoJ2FydGlzdF9pZCcsIGFydGlzdElkKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGFsYnVtSWQpIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZSBhbGJ1bSBleGlzdHNcbiAgICAgICAgICAgIGlmIChhbGJ1bUlkLmxlbmd0aCkge1xuICAgICAgICAgICAgICB2YXIgYWxidW1JZCA9IGFsYnVtSWRbMF0uaWQ7XG4gICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB1c2VyIGhhcyBsaXN0ZW5lZCB0byBpdCBiZWZvcmVcbiAgICAgICAgICAgICAga25leCgndXNlcnMnKS5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgICAud2hlcmUoJ3VzZXJuYW1lJywgdXNlcm5hbWUpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgdmFyIHVzZXJJZCA9IHVzZXJJZFswXS5pZDtcbiAgICAgICAgICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKS5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgICAgIC53aGVyZSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgICAgICAgICAgIC53aGVyZSgnYWxidW1faWQnLCBhbGJ1bUlkKVxuICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaW1wcmVzc0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHVzZXIgaGFzIGxpc3RlbmVkIHRvIGFsYnVtXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbXByZXNzSWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGltcHJlc3NJZCA9IGltcHJlc3NJZFswXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSBuZXcgbGlzdGVuIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICBrbmV4KCdsaXN0ZW5fZGF0ZScpLnNlbGVjdCgnaWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndoZXJlKCdhbGJ1bV9pbXByZXNzaW9uX2lkJywgaW1wcmVzc0lkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndoZXJlKCdkYXRlJywgZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCBmdW5jdGlvbiAobGlzdGVuSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RlbklkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5zZW5kKCdZb3UgYWxyZWFkeSBsaXN0ZW5lZCB0byB0aGlzIGFsYnVtIHRoYXQgZGF5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtuZXgoJ2xpc3Rlbl9kYXRlJykuaW5zZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGJ1bV9pbXByZXNzaW9uX2lkOiBpbXByZXNzSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDEpLnNlbmQoJ1N1Y2Nlc3NmdWwgUG9zdCEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBsaXN0ZW5fZGF0ZSAjMScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBncmFiYmluZyBsaXN0ZW5EYXRlSWQgIzEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgLy9pZiB1c2VyIGhhcyBub3QgbGlzdGVuZWQgdG8gYWxidW1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAvL2FkZCBhbiBhbGJ1bV9pbXByZXNzaW9uIGZvciB0aGUgdXNlclxuICAgICAgICAgICAgICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKS5yZXR1cm5pbmcoJ2lkJylcbiAgICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsYnVtX2lkOiBhbGJ1bUlkXG4gICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihpbXByZXNzSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbXByZXNzSWQgPSBpbXByZXNzSWRbMF0uaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgbmV3IGxpc3RlbiBkYXRlIGZvciBhbGJ1bVxuICAgICAgICAgICAgICAgICAgICAgICAga25leCgnbGlzdGVuX2RhdGUnKS5pbnNlcnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF0ZSc6IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdhbGJ1bV9pbXByZXNzaW9uX2lkJzogaW1wcmVzc0lkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMSkuc2VuZCgnU3VjY2Vzc2Z1bCBQb3N0IScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGxpc3Rlbl9kYXRlICMyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGFsYnVtX2ltcHJlc3Npb24gIzEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIGFsYnVtX2ltcHJlc3Npb25faWQgIzEnKTtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIGFsYnVtSWQnKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBpZiBhbGJ1bSBkb2VzIG5vdCBleGlzdFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gaW5zZXJ0IGFsYnVtXG4gICAgICAgICAgICAgIGtuZXgoJ2FsYnVtJykucmV0dXJuaW5nKCdpZCcpXG4gICAgICAgICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICAgICAgICB0aXRsZTogYWxidW0uY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICBhcnRpc3RfaWQ6IGFydGlzdElkLFxuICAgICAgICAgICAgICAgICAgZ2VucmU6IGFsYnVtLnByaW1hcnlHZW5yZU5hbWUsXG4gICAgICAgICAgICAgICAgICB5ZWFyOiBhbGJ1bS5yZWxlYXNlRGF0ZS5zbGljZSgwLDQpLFxuICAgICAgICAgICAgICAgICAgYXJ0X3VybDYwOiBhbGJ1bS5hcnR3b3JrVXJsNjAsXG4gICAgICAgICAgICAgICAgICBhcnRfdXJsMTAwOiBhbGJ1bS5hcnR3b3JrVXJsMTAwXG4gICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oYWxidW1JZCkge1xuICAgICAgICAgICAgICAgICAgdmFyIGFsYnVtSWQgPSBhbGJ1bUlkWzBdO1xuICAgICAgICAgICAgICAgICAgLy8gZmluZCB1c2VyJ3MgaWRcbiAgICAgICAgICAgICAgICAgIGtuZXguZnJvbSgndXNlcnMnKVxuICAgICAgICAgICAgICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgICAgICAgICAgICAgIC53aGVyZSgndXNlcm5hbWUnLCB1c2VybmFtZSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJJZCA9IHVzZXJJZFswXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYWxidW0gaW1wcmVzc2lvbiBmcm9tIHVzZXJcbiAgICAgICAgICAgICAgICAgICAgICBrbmV4KCdhbGJ1bV9pbXByZXNzaW9uJykucmV0dXJuaW5nKCdpZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhbGJ1bV9pZDogYWxidW1JZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihpbXByZXNzSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltcHJlc3NJZCA9IGltcHJlc3NJZFswXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIG5ldyBsaXN0ZW4gZGF0ZSBmb3IgYWxidW1cbiAgICAgICAgICAgICAgICAgICAgICAgICAga25leCgnbGlzdGVuX2RhdGUnKS5pbnNlcnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJzogZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWxidW1faW1wcmVzc2lvbl9pZCc6IGltcHJlc3NJZH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAxKS5zZW5kKCdTdWNjZXNzZnVsIFBvc3QhJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBpbnNlcnRpbmcgbGlzdGVuX2RhdGUgIzMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGFsYnVtX2ltcHJlc3Npb24gIzInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBncmFiYmluZyB1c2VySWQgIzInKTtcbiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGFsYnVtICMxJyk7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBncmFiYmluZyBhbGJ1bUlkICMxJyk7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgLy8gYWRkIGFydGlzdCB0byBkYlxuICAgICAga25leCgnYXJ0aXN0JykucmV0dXJuaW5nKCdpZCcpXG4gICAgICAgIC5pbnNlcnQoe25hbWU6IGFsYnVtLmFydGlzdE5hbWV9KVxuICAgICAgICAudGhlbihmdW5jdGlvbihhcnRpc3RJZCkge1xuICAgICAgICAgIHZhciBhcnRpc3RJZCA9IGFydGlzdElkWzBdO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdhcnRpc3RJZCcsIGFydGlzdElkKTtcbiAgICAgICAgICAvLyBhZGQgYWxidW0gdG8gZGJcbiAgICAgICAgICBrbmV4KCdhbGJ1bScpLnJldHVybmluZygnaWQnKVxuICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgdGl0bGU6IGFsYnVtLmNvbGxlY3Rpb25OYW1lLFxuICAgICAgICAgICAgYXJ0aXN0X2lkOiBhcnRpc3RJZCxcbiAgICAgICAgICAgIGdlbnJlOiBhbGJ1bS5wcmltYXJ5R2VucmVOYW1lLFxuICAgICAgICAgICAgeWVhcjogYWxidW0ucmVsZWFzZURhdGUuc2xpY2UoMCw0KSxcbiAgICAgICAgICAgIGFydF91cmw2MDogYWxidW0uYXJ0d29ya1VybDYwLFxuICAgICAgICAgICAgYXJ0X3VybDEwMDogYWxidW0uYXJ0d29ya1VybDEwMFxuICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGFsYnVtSWQpIHtcbiAgICAgICAgICAgIHZhciBhbGJ1bUlkID0gYWxidW1JZFswXTtcbiAgICAgICAgICAgIC8vIGZpbmQgdXNlcidzIGlkXG4gICAgICAgICAgICBrbmV4LmZyb20oJ3VzZXJzJylcbiAgICAgICAgICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgICAgICAgICAud2hlcmUoJ3VzZXJuYW1lJywgdXNlcm5hbWUpXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSB1c2VySWRbMF0uaWQ7XG4gICAgICAgICAgICAgICAgLy8gYWRkIGFsYnVtIGltcHJlc3Npb24gZnJvbSB1c2VyXG4gICAgICAgICAgICAgICAga25leCgnYWxidW1faW1wcmVzc2lvbicpLnJldHVybmluZygnaWQnKVxuICAgICAgICAgICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgYWxidW1faWQ6IGFsYnVtSWRcbiAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oaW1wcmVzc0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbXByZXNzSWQgPSBpbXByZXNzSWRbMF07XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBuZXcgbGlzdGVuIGRhdGUgZm9yIGFsYnVtXG4gICAgICAgICAgICAgICAgICAgIGtuZXgoJ2xpc3Rlbl9kYXRlJykuaW5zZXJ0KHsnZGF0ZSc6IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgJ2FsYnVtX2ltcHJlc3Npb25faWQnOiBpbXByZXNzSWR9KVxuICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDEpLnNlbmQoJ1N1Y2Nlc3NmdWwgUG9zdCEnKTtcbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBsaXN0ZW5fZGF0ZSAjNCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGFsYnVtX2ltcHJlc3Npb24gIzMnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBzZWxlY3RpbmcgdXNlcklkICMzJyk7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBhbGJ1bSAjMicpO1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGFydGlzdCAjMScpO1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfSk7O1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggZ3JhYmJpbmcgYXJ0aXN0SWQgIzEnKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9KTtcbn0pO1xuXG4vLyBhZGQvdXBkYXRlIGltcHJlc3Npb25cbnJvdXRlci5wb3N0KCcvdXBkYXRlJywgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gIHZhciBpbXByZXNzID0gcmVxLmJvZHk7XG4gIHZhciBpZCA9IE51bWJlcihpbXByZXNzLmlkKTtcbiAgdmFyIHJhdGluZyA9IE51bWJlcihpbXByZXNzLnJhdGluZyk7XG4gIHZhciBpbXByZXNzaW9uID0gaW1wcmVzcy5pbXByZXNzaW9uO1xuICBjb25zb2xlLmxvZygnaW1wcmVzcycsIGltcHJlc3MpO1xuXG4gIC8vIGlmIGltcHJlc3Npb24gZXhpc3RzIGFuZCByYXRpbmcgZG9lc24ndFxuICBpZiAoaW1wcmVzc2lvbiAmJiAhcmF0aW5nKSB7XG4gICAga25leCgnYWxidW1faW1wcmVzc2lvbicpXG4gICAgLndoZXJlKCdpZCcsIGltcHJlc3MuaWQpXG4gICAgLy91cGRhdGUgaW1wcmVzc2lvbiB3LyByZXEuYm9keVxuICAgIC51cGRhdGUoe1xuICAgICAgaW1wcmVzc2lvbjppbXByZXNzaW9uLFxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmVzLnN0YXR1cygyMDEpLmVuZCgpO1xuICAgIH0pXG4gIC8vIGlmIHJhdGluZyBleGlzdHMgYW5kIGltcHJlc3Npb24gZG9lc24ndFxuICB9IGVsc2UgaWYgKHJhdGluZyAmJiAhaW1wcmVzc2lvbikge1xuICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKVxuICAgIC53aGVyZSgnaWQnLCBpbXByZXNzLmlkKVxuICAgIC8vdXBkYXRlIHJhdGluZyB3LyByZXEuYm9keVxuICAgIC51cGRhdGUoe1xuICAgICAgcmF0aW5nOiByYXRpbmdcbiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5lbmQoKTtcbiAgICB9KVxuICAvLyBpZiByYXRpbmcgYW5kIGltcHJlc3Npb24gZXhpc3RcbiAgfSBlbHNlIGlmIChyYXRpbmcgJiYgaW1wcmVzc2lvbikge1xuICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKVxuICAgIC53aGVyZSgnaWQnLCBpbXByZXNzLmlkKVxuICAgIC8vdXBkYXRlIGltcHJlc3Npb24gYW5kIHJhdGluZyB3LyByZXEuYm9keVxuICAgIC51cGRhdGUoe1xuICAgICAgaW1wcmVzc2lvbjppbXByZXNzLmltcHJlc3Npb24sXG4gICAgICByYXRpbmc6IGltcHJlc3MucmF0aW5nXG4gICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICByZXMuc3RhdHVzKDIwMSkuZW5kKCk7XG4gICAgfSlcbiAgLy8gaWYgdGhlIHVzZXIgc2VudCBhIGJsYW5rIHNhdmVcbiAgfSBlbHNlIHtcbiAgICAvLyBkbyBub3RoaW5nXG4gICAgcmVzLmVuZCgpO1xuICB9XG59KTtcblxuLy8gcmVtb3ZlIGxpc3Rlbl9kYXRlXG5yb3V0ZXIucG9zdCgnL2RlbGV0ZScsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICB2YXIgbGlzdGVuRW50cnkgPSByZXEuYm9keTtcbiAgLy9maW5kIHRoZSBsaXN0ZW5fZGF0ZSBFbnRyeVxuICBrbmV4KCdsaXN0ZW5fZGF0ZScpXG4gICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgbW9yZSB0aGFuIDEgZGF0ZSBmb3IgdGhhdCBpbXByZXNzaW9uX2lkXG4gICAgLndoZXJlKCdhbGJ1bV9pbXByZXNzaW9uX2lkJywgbGlzdGVuRW50cnkuaW1wcmVzc2lvbklkKVxuICAgIC50aGVuKGZ1bmN0aW9uIChkYXRlcykge1xuICAgICAgaWYgKGRhdGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgLy8gZGVsZXRlIGxpc3Rlbl9kYXRlIGVudHJ5XG4gICAgICAgIGtuZXgoJ2xpc3Rlbl9kYXRlJylcbiAgICAgICAgLndoZXJlKCdhbGJ1bV9pbXByZXNzaW9uX2lkJywgbGlzdGVuRW50cnkuaW1wcmVzc2lvbklkKVxuICAgICAgICAud2hlcmUoJ2RhdGUnLCBsaXN0ZW5FbnRyeS5kYXRlKVxuICAgICAgICAuZGVsKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJlcy5zdGF0dXMoMjAxKS5zZW5kKCdTdWNjZXNzZnVsbHkgcmVtb3ZlZCBhbGJ1bScpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gaWYgYWxidW1faW1wcmVzc19pZCA9IDFcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGRlbGV0ZSBhbGJ1bV9pbXByZXNzaW9uXG4gICAgICAgIGtuZXgoJ2xpc3Rlbl9kYXRlJylcbiAgICAgICAgLndoZXJlKCdhbGJ1bV9pbXByZXNzaW9uX2lkJywgbGlzdGVuRW50cnkuaW1wcmVzc2lvbklkKVxuICAgICAgICAud2hlcmUoJ2RhdGUnLCBsaXN0ZW5FbnRyeS5kYXRlKVxuICAgICAgICAuZGVsKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKVxuICAgICAgICAgIC53aGVyZSgnaWQnLCBsaXN0ZW5FbnRyeS5pbXByZXNzaW9uSWQpXG4gICAgICAgICAgLmRlbCgpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDEpLnNlbmQoJ1N1Y2Nlc3NmdWxseSByZW1vdmVkIGFsYnVtJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xuIl19
=======
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9yb3V0ZXMvZGJSb3V0ZXMuanMiXSwibmFtZXMiOlsiZXhwcmVzcyIsInJlcXVpcmUiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJwYXRoIiwidXRpbCIsImtuZXgiLCJnZXQiLCJyZXEiLCJyZXMiLCJ1c2VybmFtZSIsImNvb2tpZXMiLCJmcm9tIiwiam9pbiIsIndoZXJlIiwic2VsZWN0Iiwib3JkZXJCeSIsInRoZW4iLCJyZXN1bHQiLCJjb25zb2xlIiwibG9nIiwic3RhdHVzIiwic2VuZCIsImNhdGNoIiwiZXJyIiwicG9zdCIsImFsYnVtIiwiYm9keSIsImRhdGUiLCJzbGljZSIsIm5hbWUiLCJhcnRpc3ROYW1lIiwiYXJ0aXN0SWQiLCJsZW5ndGgiLCJpZCIsImNvbGxlY3Rpb25OYW1lIiwiYWxidW1JZCIsInVzZXJJZCIsImltcHJlc3NJZCIsImxpc3RlbklkIiwiaW5zZXJ0IiwiYWxidW1faW1wcmVzc2lvbl9pZCIsInJldHVybmluZyIsInVzZXJfaWQiLCJhbGJ1bV9pZCIsInRpdGxlIiwiYXJ0aXN0X2lkIiwiZ2VucmUiLCJwcmltYXJ5R2VucmVOYW1lIiwieWVhciIsInJlbGVhc2VEYXRlIiwiYXJ0X3VybDYwIiwiYXJ0d29ya1VybDYwIiwiYXJ0X3VybDEwMCIsImFydHdvcmtVcmwxMDAiLCJpbXByZXNzIiwiTnVtYmVyIiwicmF0aW5nIiwiaW1wcmVzc2lvbiIsInVwZGF0ZSIsImVuZCIsImxpc3RlbkVudHJ5IiwiaW1wcmVzc2lvbklkIiwiZGF0ZXMiLCJkZWwiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFVBQVVDLFFBQVEsU0FBUixDQUFkO0FBQ0EsSUFBSUMsU0FBU0YsUUFBUUcsTUFBUixFQUFiO0FBQ0EsSUFBSUMsT0FBT0gsUUFBUSxNQUFSLENBQVg7QUFDQSxJQUFJSSxPQUFPSixRQUFRLGlCQUFSLENBQVg7QUFDQSxJQUFJSyxPQUFPTCxRQUFRLGdCQUFSLENBQVg7O0FB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QWpDRDs7QUFtQ0EyQyxPQUFPQyxPQUFQLEdBQWlCaEUsTUFBakIiLCJmaWxlIjoiZGJSb3V0ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xudmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG52YXIgdXRpbCA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy5qcycpO1xudmFyIGtuZXggPSByZXF1aXJlKCcuLi8uLi9kYi9kYi5qcycpO1xuXG4vLyBxdWVyaWVzIGRhdGFiYXNlIGFuZCByZXR1cm5zIHVzZXIncyBhbGJ1bSBlbnRyaWVzXG5yb3V0ZXIuZ2V0KCcvJywgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gIC8vIGdldCB1c2VybmFtZSBmcm9tIHRoZSBjb29raWVcbiAgdmFyIHVzZXJuYW1lID0gcmVxLmNvb2tpZXMudXNlcm5hbWU7XG4gIC8vIGZpbmQgYWxsIGxpc3RlbiBpbnN0YW5jZXMgYnkgdGhlIHVzZXJcbiAga25leC5mcm9tKCd1c2VyJylcbiAgICAgIC5qb2luKCdhbGJ1bV9pbXByZXNzaW9uJywgJ3VzZXIuaWQnLCAnYWxidW1faW1wcmVzc2lvbi51c2VyX2lkJylcbiAgICAgIC53aGVyZSgndXNlci51c2VybmFtZScsIHVzZXJuYW1lKVxuICAgICAgLmpvaW4oJ2FsYnVtJywgJ2FsYnVtX2ltcHJlc3Npb24uYWxidW1faWQnLCAnYWxidW0uaWQnKVxuICAgICAgLmpvaW4oJ2FydGlzdCcsICdhcnRpc3QuaWQnLCAnYWxidW0uYXJ0aXN0X2lkJylcbiAgICAgIC5qb2luKCdsaXN0ZW5fZGF0ZScsICdsaXN0ZW5fZGF0ZS5hbGJ1bV9pbXByZXNzaW9uX2lkJywgJ2FsYnVtX2ltcHJlc3Npb24uaWQnKVxuICAgICAgLnNlbGVjdCgndXNlci51c2VyJyxcbiAgICAgICAgICAgICAgJ2xpc3Rlbl9kYXRlLmRhdGUnLFxuICAgICAgICAgICAgICAnYWxidW0udGl0bGUnLCAnYXJ0aXN0Lm5hbWUnLCAnYWxidW0uZ2VucmUnLCAnYWxidW0ueWVhcicsXG4gICAgICAgICAgICAgICdhbGJ1bV9pbXByZXNzaW9uLnJhdGluZycsICdhbGJ1bV9pbXByZXNzaW9uLmltcHJlc3Npb24nLCAnYWxidW1faW1wcmVzc2lvbi5pZCcsXG4gICAgICAgICAgICAgICdhbGJ1bS5hcnRfdXJsNjAnLCAnYWxidW0uYXJ0X3VybDEwMCcpXG4gICAgICAub3JkZXJCeSgnbGlzdGVuX2RhdGUuZGF0ZScsICdkZXNjJylcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgLy8gc2VuZCB0aGUgcmVzdWx0IGJhY2sgdG8gdGhlIHVzZXJcbiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzdWx0KTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSBncmFiYmluZyB1c2VyIGluZm8nKTtcbiAgICAgIH0pXG59KTtcblxuLy8gcG9zdCBuZXcgYWxidW0gdG8gdGhlIGRhdGFiYXNlXG5yb3V0ZXIucG9zdCgnLycsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICB2YXIgYWxidW0gPSByZXEuYm9keS5hbGJ1bTtcbiAgLy8gcHV0IGRhdGUgaW50byBjb3JyZWN0IGZvcm1hdCBmb3IgZGJcbiAgdmFyIGRhdGUgPSByZXEuYm9keS5kYXRlLnNsaWNlKDAsIDEwKTtcbiAgdmFyIHVzZXJuYW1lID0gcmVxLmNvb2tpZXMudXNlcm5hbWU7XG4gIC8vIGNoZWNrIGlmIGFydGlzdCBpcyBpbiBkYlxuICBrbmV4KCdhcnRpc3QnKVxuICAgIC53aGVyZSh7bmFtZSA6IGFsYnVtLmFydGlzdE5hbWV9KVxuICAgIC5zZWxlY3QoJ2lkJylcbiAgICAudGhlbihmdW5jdGlvbihhcnRpc3RJZCkge1xuICAgICAgaWYgKGFydGlzdElkLmxlbmd0aCkge1xuICAgICAgdmFyIGFydGlzdElkID0gYXJ0aXN0SWRbMF0uaWQ7XG4gICAgICAvLyBjaGVjayBpZiB0aGUgYWxidW0gaXMgYWxyZWFkeSBpbiB0aGUgZGF0YWJhc2VcbiAgICAgICAga25leCgnYWxidW0nKVxuICAgICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAud2hlcmUoJ3RpdGxlJywgYWxidW0uY29sbGVjdGlvbk5hbWUpXG4gICAgICAgICAgLndoZXJlKCdhcnRpc3RfaWQnLCBhcnRpc3RJZClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihhbGJ1bUlkKSB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgYWxidW0gZXhpc3RzXG4gICAgICAgICAgICBpZiAoYWxidW1JZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgdmFyIGFsYnVtSWQgPSBhbGJ1bUlkWzBdLmlkO1xuICAgICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdXNlciBoYXMgbGlzdGVuZWQgdG8gaXQgYmVmb3JlXG4gICAgICAgICAgICAgIGtuZXgoJ3VzZXInKS5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgICAud2hlcmUoJ3VzZXJuYW1lJywgdXNlcm5hbWUpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgdmFyIHVzZXJJZCA9IHVzZXJJZFswXS5pZDtcbiAgICAgICAgICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKS5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgICAgIC53aGVyZSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgICAgICAgICAgIC53aGVyZSgnYWxidW1faWQnLCBhbGJ1bUlkKVxuICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaW1wcmVzc0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHVzZXIgaGFzIGxpc3RlbmVkIHRvIGFsYnVtXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbXByZXNzSWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGltcHJlc3NJZCA9IGltcHJlc3NJZFswXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSBuZXcgbGlzdGVuIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICBrbmV4KCdsaXN0ZW5fZGF0ZScpLnNlbGVjdCgnaWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndoZXJlKCdhbGJ1bV9pbXByZXNzaW9uX2lkJywgaW1wcmVzc0lkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndoZXJlKCdkYXRlJywgZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCBmdW5jdGlvbiAobGlzdGVuSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RlbklkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5zZW5kKCdZb3UgYWxyZWFkeSBsaXN0ZW5lZCB0byB0aGlzIGFsYnVtIHRoYXQgZGF5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtuZXgoJ2xpc3Rlbl9kYXRlJykuaW5zZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGJ1bV9pbXByZXNzaW9uX2lkOiBpbXByZXNzSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDEpLnNlbmQoJ1N1Y2Nlc3NmdWwgUG9zdCEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBsaXN0ZW5fZGF0ZSAjMScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBncmFiYmluZyBsaXN0ZW5EYXRlSWQgIzEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgLy9pZiB1c2VyIGhhcyBub3QgbGlzdGVuZWQgdG8gYWxidW1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAvL2FkZCBhbiBhbGJ1bV9pbXByZXNzaW9uIGZvciB0aGUgdXNlclxuICAgICAgICAgICAgICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKS5yZXR1cm5pbmcoJ2lkJylcbiAgICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsYnVtX2lkOiBhbGJ1bUlkXG4gICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihpbXByZXNzSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbXByZXNzSWQgPSBpbXByZXNzSWRbMF0uaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgbmV3IGxpc3RlbiBkYXRlIGZvciBhbGJ1bVxuICAgICAgICAgICAgICAgICAgICAgICAga25leCgnbGlzdGVuX2RhdGUnKS5pbnNlcnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF0ZSc6IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdhbGJ1bV9pbXByZXNzaW9uX2lkJzogaW1wcmVzc0lkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMSkuc2VuZCgnU3VjY2Vzc2Z1bCBQb3N0IScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGxpc3Rlbl9kYXRlICMyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggaW5zZXJ0aW5nIGFsYnVtX2ltcHJlc3Npb24gIzEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIGFsYnVtX2ltcHJlc3Npb25faWQgIzEnKTtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIGFsYnVtSWQnKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBpZiBhbGJ1bSBkb2VzIG5vdCBleGlzdFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gaW5zZXJ0IGFsYnVtXG4gICAgICAgICAgICAgIGtuZXgoJ2FsYnVtJykucmV0dXJuaW5nKCdpZCcpXG4gICAgICAgICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICAgICAgICB0aXRsZTogYWxidW0uY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICBhcnRpc3RfaWQ6IGFydGlzdElkLFxuICAgICAgICAgICAgICAgICAgZ2VucmU6IGFsYnVtLnByaW1hcnlHZW5yZU5hbWUsXG4gICAgICAgICAgICAgICAgICB5ZWFyOiBhbGJ1bS5yZWxlYXNlRGF0ZS5zbGljZSgwLDQpLFxuICAgICAgICAgICAgICAgICAgYXJ0X3VybDYwOiBhbGJ1bS5hcnR3b3JrVXJsNjAsXG4gICAgICAgICAgICAgICAgICBhcnRfdXJsMTAwOiBhbGJ1bS5hcnR3b3JrVXJsMTAwXG4gICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oYWxidW1JZCkge1xuICAgICAgICAgICAgICAgICAgdmFyIGFsYnVtSWQgPSBhbGJ1bUlkWzBdO1xuICAgICAgICAgICAgICAgICAgLy8gZmluZCB1c2VyJ3MgaWRcbiAgICAgICAgICAgICAgICAgIGtuZXguZnJvbSgndXNlcicpXG4gICAgICAgICAgICAgICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgICAgICAgLndoZXJlKCd1c2VybmFtZScsIHVzZXJuYW1lKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcklkID0gdXNlcklkWzBdLmlkO1xuICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBhbGJ1bSBpbXByZXNzaW9uIGZyb20gdXNlclxuICAgICAgICAgICAgICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKS5yZXR1cm5pbmcoJ2lkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFsYnVtX2lkOiBhbGJ1bUlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGltcHJlc3NJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1wcmVzc0lkID0gaW1wcmVzc0lkWzBdLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgbmV3IGxpc3RlbiBkYXRlIGZvciBhbGJ1bVxuICAgICAgICAgICAgICAgICAgICAgICAgICBrbmV4KCdsaXN0ZW5fZGF0ZScpLmluc2VydCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGUnOiBkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhbGJ1bV9pbXByZXNzaW9uX2lkJzogaW1wcmVzc0lkfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDEpLnNlbmQoJ1N1Y2Nlc3NmdWwgUG9zdCEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBsaXN0ZW5fZGF0ZSAjMycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBpbnNlcnRpbmcgYWxidW1faW1wcmVzc2lvbiAjMicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIHVzZXJJZCAjMicpO1xuICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBpbnNlcnRpbmcgYWxidW0gIzEnKTtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIGFsYnVtSWQgIzEnKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAvLyBhZGQgYXJ0aXN0IHRvIGRiXG4gICAgICBrbmV4KCdhcnRpc3QnKS5yZXR1cm5pbmcoJ2lkJylcbiAgICAgICAgLmluc2VydCh7bmFtZTogYWxidW0uYXJ0aXN0TmFtZX0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGFydGlzdElkKSB7XG4gICAgICAgICAgdmFyIGFydGlzdElkID0gYXJ0aXN0SWRbMF07XG4gICAgICAgICAgY29uc29sZS5sb2coJ2FydGlzdElkJywgYXJ0aXN0SWQpO1xuICAgICAgICAgIC8vIGFkZCBhbGJ1bSB0byBkYlxuICAgICAgICAgIGtuZXgoJ2FsYnVtJykucmV0dXJuaW5nKCdpZCcpXG4gICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICB0aXRsZTogYWxidW0uY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgICBhcnRpc3RfaWQ6IGFydGlzdElkLFxuICAgICAgICAgICAgZ2VucmU6IGFsYnVtLnByaW1hcnlHZW5yZU5hbWUsXG4gICAgICAgICAgICB5ZWFyOiBhbGJ1bS5yZWxlYXNlRGF0ZS5zbGljZSgwLDQpLFxuICAgICAgICAgICAgYXJ0X3VybDYwOiBhbGJ1bS5hcnR3b3JrVXJsNjAsXG4gICAgICAgICAgICBhcnRfdXJsMTAwOiBhbGJ1bS5hcnR3b3JrVXJsMTAwXG4gICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oYWxidW1JZCkge1xuICAgICAgICAgICAgdmFyIGFsYnVtSWQgPSBhbGJ1bUlkWzBdO1xuICAgICAgICAgICAgLy8gZmluZCB1c2VyJ3MgaWRcbiAgICAgICAgICAgIGtuZXguZnJvbSgndXNlcicpXG4gICAgICAgICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgLndoZXJlKCd1c2VybmFtZScsIHVzZXJuYW1lKVxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXNlcklkID0gdXNlcklkWzBdLmlkO1xuICAgICAgICAgICAgICAgIC8vIGFkZCBhbGJ1bSBpbXByZXNzaW9uIGZyb20gdXNlclxuICAgICAgICAgICAgICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKS5yZXR1cm5pbmcoJ2lkJylcbiAgICAgICAgICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgIGFsYnVtX2lkOiBhbGJ1bUlkXG4gICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGltcHJlc3NJZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1wcmVzc0lkID0gaW1wcmVzc0lkWzBdO1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgbmV3IGxpc3RlbiBkYXRlIGZvciBhbGJ1bVxuICAgICAgICAgICAgICAgICAgICBrbmV4KCdsaXN0ZW5fZGF0ZScpLmluc2VydCh7J2RhdGUnOiBkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICdhbGJ1bV9pbXByZXNzaW9uX2lkJzogaW1wcmVzc0lkfSlcbiAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAxKS5zZW5kKCdTdWNjZXNzZnVsIFBvc3QhJyk7XG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBpbnNlcnRpbmcgbGlzdGVuX2RhdGUgIzQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBhbGJ1bV9pbXByZXNzaW9uICMzJyk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9ibGVtIHdpdGggc2VsZWN0aW5nIHVzZXJJZCAjMycpO1xuICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2JsZW0gd2l0aCBpbnNlcnRpbmcgYWxidW0gIzInKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGluc2VydGluZyBhcnRpc3QgIzEnKTtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pOztcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZygnUHJvYmxlbSB3aXRoIGdyYWJiaW5nIGFydGlzdElkICMxJyk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSk7XG59KTtcblxuLy8gYWRkL3VwZGF0ZSBpbXByZXNzaW9uXG5yb3V0ZXIucG9zdCgnL3VwZGF0ZScsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICB2YXIgaW1wcmVzcyA9IHJlcS5ib2R5O1xuICB2YXIgaWQgPSBOdW1iZXIoaW1wcmVzcy5pZCk7XG4gIHZhciByYXRpbmcgPSBOdW1iZXIoaW1wcmVzcy5yYXRpbmcpO1xuICB2YXIgaW1wcmVzc2lvbiA9IGltcHJlc3MuaW1wcmVzc2lvbjtcbiAgY29uc29sZS5sb2coJ2ltcHJlc3MnLCBpbXByZXNzKTtcblxuICAvLyBpZiBpbXByZXNzaW9uIGV4aXN0cyBhbmQgcmF0aW5nIGRvZXNuJ3RcbiAgaWYgKGltcHJlc3Npb24gJiYgIXJhdGluZykge1xuICAgIGtuZXgoJ2FsYnVtX2ltcHJlc3Npb24nKVxuICAgIC53aGVyZSgnaWQnLCBpbXByZXNzLmlkKVxuICAgIC8vdXBkYXRlIGltcHJlc3Npb24gdy8gcmVxLmJvZHlcbiAgICAudXBkYXRlKHtcbiAgICAgIGltcHJlc3Npb246aW1wcmVzc2lvbixcbiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5lbmQoKTtcbiAgICB9KVxuICAvLyBpZiByYXRpbmcgZXhpc3RzIGFuZCBpbXByZXNzaW9uIGRvZXNuJ3RcbiAgfSBlbHNlIGlmIChyYXRpbmcgJiYgIWltcHJlc3Npb24pIHtcbiAgICBrbmV4KCdhbGJ1bV9pbXByZXNzaW9uJylcbiAgICAud2hlcmUoJ2lkJywgaW1wcmVzcy5pZClcbiAgICAvL3VwZGF0ZSByYXRpbmcgdy8gcmVxLmJvZHlcbiAgICAudXBkYXRlKHtcbiAgICAgIHJhdGluZzogcmF0aW5nXG4gICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICByZXMuc3RhdHVzKDIwMSkuZW5kKCk7XG4gICAgfSlcbiAgLy8gaWYgcmF0aW5nIGFuZCBpbXByZXNzaW9uIGV4aXN0XG4gIH0gZWxzZSBpZiAocmF0aW5nICYmIGltcHJlc3Npb24pIHtcbiAgICBrbmV4KCdhbGJ1bV9pbXByZXNzaW9uJylcbiAgICAud2hlcmUoJ2lkJywgaW1wcmVzcy5pZClcbiAgICAvL3VwZGF0ZSBpbXByZXNzaW9uIGFuZCByYXRpbmcgdy8gcmVxLmJvZHlcbiAgICAudXBkYXRlKHtcbiAgICAgIGltcHJlc3Npb246aW1wcmVzcy5pbXByZXNzaW9uLFxuICAgICAgcmF0aW5nOiBpbXByZXNzLnJhdGluZ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmVzLnN0YXR1cygyMDEpLmVuZCgpO1xuICAgIH0pXG4gIC8vIGlmIHRoZSB1c2VyIHNlbnQgYSBibGFuayBzYXZlXG4gIH0gZWxzZSB7XG4gICAgLy8gZG8gbm90aGluZ1xuICAgIHJlcy5lbmQoKTtcbiAgfVxufSk7XG5cbi8vIHJlbW92ZSBsaXN0ZW5fZGF0ZVxucm91dGVyLnBvc3QoJy9kZWxldGUnLCBmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgdmFyIGxpc3RlbkVudHJ5ID0gcmVxLmJvZHk7XG4gIC8vZmluZCB0aGUgbGlzdGVuX2RhdGUgRW50cnlcbiAga25leCgnbGlzdGVuX2RhdGUnKVxuICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiAxIGRhdGUgZm9yIHRoYXQgaW1wcmVzc2lvbl9pZFxuICAgIC53aGVyZSgnYWxidW1faW1wcmVzc2lvbl9pZCcsIGxpc3RlbkVudHJ5LmltcHJlc3Npb25JZClcbiAgICAudGhlbihmdW5jdGlvbiAoZGF0ZXMpIHtcbiAgICAgIGlmIChkYXRlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIC8vIGRlbGV0ZSBsaXN0ZW5fZGF0ZSBlbnRyeVxuICAgICAgICBrbmV4KCdsaXN0ZW5fZGF0ZScpXG4gICAgICAgIC53aGVyZSgnYWxidW1faW1wcmVzc2lvbl9pZCcsIGxpc3RlbkVudHJ5LmltcHJlc3Npb25JZClcbiAgICAgICAgLndoZXJlKCdkYXRlJywgbGlzdGVuRW50cnkuZGF0ZSlcbiAgICAgICAgLmRlbCgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMSkuc2VuZCgnU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgYWxidW0nKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGlmIGFsYnVtX2ltcHJlc3NfaWQgPSAxXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBkZWxldGUgYWxidW1faW1wcmVzc2lvblxuICAgICAgICBrbmV4KCdsaXN0ZW5fZGF0ZScpXG4gICAgICAgIC53aGVyZSgnYWxidW1faW1wcmVzc2lvbl9pZCcsIGxpc3RlbkVudHJ5LmltcHJlc3Npb25JZClcbiAgICAgICAgLndoZXJlKCdkYXRlJywgbGlzdGVuRW50cnkuZGF0ZSlcbiAgICAgICAgLmRlbCgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBrbmV4KCdhbGJ1bV9pbXByZXNzaW9uJylcbiAgICAgICAgICAud2hlcmUoJ2lkJywgbGlzdGVuRW50cnkuaW1wcmVzc2lvbklkKVxuICAgICAgICAgIC5kZWwoKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAxKS5zZW5kKCdTdWNjZXNzZnVsbHkgcmVtb3ZlZCBhbGJ1bScpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==
>>>>>>> eaaa83cea770bf33423ca0f7046d02accc21f4d1
