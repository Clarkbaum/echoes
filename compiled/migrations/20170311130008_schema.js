'use strict';

exports.up = function (knex, Promise) {
  return Promise.all([
  //users
  knex.schema.createTable('users', function (table) {
    table.increments('id').primary();
    table.string('user');
    table.string('username').unique().notNullable();
    table.string('password').notNullable();
  }),

  //artists
  knex.schema.createTable('artist', function (table) {
    table.increments('id').primary();
    table.string('name').unique().notNullable();
  }),

  //many albums to one artist
  knex.schema.createTable('album', function (table) {
    table.increments('id').primary();
    table.string('title').notNullable();
    table.integer('artist_id');
    table.string('genre').notNullable();
    table.integer('year').notNullable();
    table.string('art_url60').notNullable(); //saves album art 60px size square
    table.string('art_url100').notNullable(); //saves album art 100px size square
    table.foreign('artist_id').references('artist.id');
    table.unique(['title', 'artist_id']); //guarantees no repeated albums for an artist
  }),

  //many songs to one album
  knex.schema.createTable('song', function (table) {
    table.increments('id').primary();
    table.string('title');
    table.integer('album_id');
    table.foreign('album_id').references('album.id');
    table.unique(['title', 'album_id']);
  }),

  //many users impressions to many albums
  knex.schema.createTable('album_impression', function (table) {
    table.increments('id').primary();
    table.integer('user_id');
    table.integer('album_id');
    table.integer('rating');
    table.string('impression');
    table.foreign('user_id').references('users.id');
    table.foreign('album_id').references('album.id');
    table.unique(['user_id', 'album_id']);
  }),

  //many listening dates to one album impression
  knex.schema.createTable('listen_date', function (table) {
    table.increments('id').primary();
    table.integer('album_impression_id');
    table.date('date').notNullable();
    table.foreign('album_impression_id').references('album_impression.id');
    table.unique(['album_impression_id', 'date']);
  })]);
};

exports.down = function (knex, Promise) {
  return Promise.all([knex.schema.dropTable('listen_date'), knex.schema.dropTable('album_impression'), knex.schema.dropTable('song'), knex.schema.dropTable('album'), knex.schema.dropTable('artist'), knex.schema.dropTable('users')]);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL21pZ3JhdGlvbnMvMjAxNzAzMTExMzAwMDhfc2NoZW1hLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJ1cCIsImtuZXgiLCJQcm9taXNlIiwiYWxsIiwic2NoZW1hIiwiY3JlYXRlVGFibGUiLCJ0YWJsZSIsImluY3JlbWVudHMiLCJwcmltYXJ5Iiwic3RyaW5nIiwidW5pcXVlIiwibm90TnVsbGFibGUiLCJpbnRlZ2VyIiwiZm9yZWlnbiIsInJlZmVyZW5jZXMiLCJkYXRlIiwiZG93biIsImRyb3BUYWJsZSJdLCJtYXBwaW5ncyI6Ijs7QUFDQUEsUUFBUUMsRUFBUixHQUFhLFVBQVNDLElBQVQsRUFBZUMsT0FBZixFQUF3QjtBQUNuQyxTQUFPQSxRQUFRQyxHQUFSLENBQVk7QUFDakI7QUFDQUYsT0FBS0csTUFBTCxDQUFZQyxXQUFaLENBQXdCLE9BQXhCLEVBQWlDLFVBQVNDLEtBQVQsRUFBZ0I7QUFDL0NBLFVBQU1DLFVBQU4sQ0FBaUIsSUFBakIsRUFBdUJDLE9BQXZCO0FBQ0FGLFVBQU1HLE1BQU4sQ0FBYSxNQUFiO0FBQ0FILFVBQU1HLE1BQU4sQ0FBYSxVQUFiLEVBQXlCQyxNQUF6QixHQUFrQ0MsV0FBbEM7QUFDQUwsVUFBTUcsTUFBTixDQUFhLFVBQWIsRUFBeUJFLFdBQXpCO0FBQ0QsR0FMRCxDQUZpQjs7QUFTakI7QUFDQVYsT0FBS0csTUFBTCxDQUFZQyxXQUFaLENBQXdCLFFBQXhCLEVBQWtDLFVBQVNDLEtBQVQsRUFBZ0I7QUFDaERBLFVBQU1DLFVBQU4sQ0FBaUIsSUFBakIsRUFBdUJDLE9BQXZCO0FBQ0FGLFVBQU1HLE1BQU4sQ0FBYSxNQUFiLEVBQXFCQyxNQUFyQixHQUE4QkMsV0FBOUI7QUFDRCxHQUhELENBVmlCOztBQWVqQjtBQUNBVixPQUFLRyxNQUFMLENBQVlDLFdBQVosQ0FBd0IsT0FBeEIsRUFBaUMsVUFBU0MsS0FBVCxFQUFnQjtBQUMvQ0EsVUFBTUMsVUFBTixDQUFpQixJQUFqQixFQUF1QkMsT0FBdkI7QUFD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InNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0cy51cCA9IGZ1bmN0aW9uKGtuZXgsIFByb21pc2UpIHtcbiAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAvL3VzZXJzXG4gICAga25leC5zY2hlbWEuY3JlYXRlVGFibGUoJ3VzZXJzJywgZnVuY3Rpb24odGFibGUpIHtcbiAgICAgIHRhYmxlLmluY3JlbWVudHMoJ2lkJykucHJpbWFyeSgpO1xuICAgICAgdGFibGUuc3RyaW5nKCd1c2VyJyk7XG4gICAgICB0YWJsZS5zdHJpbmcoJ3VzZXJuYW1lJykudW5pcXVlKCkubm90TnVsbGFibGUoKTtcbiAgICAgIHRhYmxlLnN0cmluZygncGFzc3dvcmQnKS5ub3ROdWxsYWJsZSgpO1xuICAgIH0pLFxuXG4gICAgLy9hcnRpc3RzXG4gICAga25leC5zY2hlbWEuY3JlYXRlVGFibGUoJ2FydGlzdCcsIGZ1bmN0aW9uKHRhYmxlKSB7XG4gICAgICB0YWJsZS5pbmNyZW1lbnRzKCdpZCcpLnByaW1hcnkoKTtcbiAgICAgIHRhYmxlLnN0cmluZygnbmFtZScpLnVuaXF1ZSgpLm5vdE51bGxhYmxlKCk7XG4gICAgfSksXG5cbiAgICAvL21hbnkgYWxidW1zIHRvIG9uZSBhcnRpc3RcbiAgICBrbmV4LnNjaGVtYS5jcmVhdGVUYWJsZSgnYWxidW0nLCBmdW5jdGlvbih0YWJsZSkge1xuICAgICAgdGFibGUuaW5jcmVtZW50cygnaWQnKS5wcmltYXJ5KCk7XG4gICAgICB0YWJsZS5zdHJpbmcoJ3RpdGxlJykubm90TnVsbGFibGUoKTtcbiAgICAgIHRhYmxlLmludGVnZXIoJ2FydGlzdF9pZCcpO1xuICAgICAgdGFibGUuc3RyaW5nKCdnZW5yZScpLm5vdE51bGxhYmxlKCk7XG4gICAgICB0YWJsZS5pbnRlZ2VyKCd5ZWFyJykubm90TnVsbGFibGUoKTtcbiAgICAgIHRhYmxlLnN0cmluZygnYXJ0X3VybDYwJykubm90TnVsbGFibGUoKTsgLy9zYXZlcyBhbGJ1bSBhcnQgNjBweCBzaXplIHNxdWFyZVxuICAgICAgdGFibGUuc3RyaW5nKCdhcnRfdXJsMTAwJykubm90TnVsbGFibGUoKTsgLy9zYXZlcyBhbGJ1bSBhcnQgMTAwcHggc2l6ZSBzcXVhcmVcbiAgICAgIHRhYmxlLmZvcmVpZ24oJ2FydGlzdF9pZCcpLnJlZmVyZW5jZXMoJ2FydGlzdC5pZCcpO1xuICAgICAgdGFibGUudW5pcXVlKFsndGl0bGUnLCAnYXJ0aXN0X2lkJ10pOyAvL2d1YXJhbnRlZXMgbm8gcmVwZWF0ZWQgYWxidW1zIGZvciBhbiBhcnRpc3RcbiAgICB9KSxcblxuICAgIC8vbWFueSBzb25ncyB0byBvbmUgYWxidW1cbiAgICBrbmV4LnNjaGVtYS5jcmVhdGVUYWJsZSgnc29uZycsIGZ1bmN0aW9uKHRhYmxlKSB7XG4gICAgICB0YWJsZS5pbmNyZW1lbnRzKCdpZCcpLnByaW1hcnkoKTtcbiAgICAgIHRhYmxlLnN0cmluZygndGl0bGUnKTtcbiAgICAgIHRhYmxlLmludGVnZXIoJ2FsYnVtX2lkJyk7XG4gICAgICB0YWJsZS5mb3JlaWduKCdhbGJ1bV9pZCcpLnJlZmVyZW5jZXMoJ2FsYnVtLmlkJyk7XG4gICAgICB0YWJsZS51bmlxdWUoWyd0aXRsZScsICdhbGJ1bV9pZCddKTtcbiAgICB9KSxcblxuICAgIC8vbWFueSB1c2VycyBpbXByZXNzaW9ucyB0byBtYW55IGFsYnVtc1xuICAgIGtuZXguc2NoZW1hLmNyZWF0ZVRhYmxlKCdhbGJ1bV9pbXByZXNzaW9uJywgZnVuY3Rpb24odGFibGUpIHtcbiAgICAgIHRhYmxlLmluY3JlbWVudHMoJ2lkJykucHJpbWFyeSgpO1xuICAgICAgdGFibGUuaW50ZWdlcigndXNlcl9pZCcpO1xuICAgICAgdGFibGUuaW50ZWdlcignYWxidW1faWQnKTtcbiAgICAgIHRhYmxlLmludGVnZXIoJ3JhdGluZycpO1xuICAgICAgdGFibGUuc3RyaW5nKCdpbXByZXNzaW9uJyk7XG4gICAgICB0YWJsZS5mb3JlaWduKCd1c2VyX2lkJykucmVmZXJlbmNlcygndXNlcnMuaWQnKTtcbiAgICAgIHRhYmxlLmZvcmVpZ24oJ2FsYnVtX2lkJykucmVmZXJlbmNlcygnYWxidW0uaWQnKTtcbiAgICAgIHRhYmxlLnVuaXF1ZShbJ3VzZXJfaWQnLCAnYWxidW1faWQnXSk7XG4gICAgfSksXG5cbiAgICAvL21hbnkgbGlzdGVuaW5nIGRhdGVzIHRvIG9uZSBhbGJ1bSBpbXByZXNzaW9uXG4gICAga25leC5zY2hlbWEuY3JlYXRlVGFibGUoJ2xpc3Rlbl9kYXRlJywgZnVuY3Rpb24odGFibGUpIHtcbiAgICAgIHRhYmxlLmluY3JlbWVudHMoJ2lkJykucHJpbWFyeSgpO1xuICAgICAgdGFibGUuaW50ZWdlcignYWxidW1faW1wcmVzc2lvbl9pZCcpO1xuICAgICAgdGFibGUuZGF0ZSgnZGF0ZScpLm5vdE51bGxhYmxlKCk7XG4gICAgICB0YWJsZS5mb3JlaWduKCdhbGJ1bV9pbXByZXNzaW9uX2lkJykucmVmZXJlbmNlcygnYWxidW1faW1wcmVzc2lvbi5pZCcpO1xuICAgICAgdGFibGUudW5pcXVlKFsnYWxidW1faW1wcmVzc2lvbl9pZCcsICdkYXRlJ10pO1xuICAgIH0pXG4gIF0pO1xufTtcblxuZXhwb3J0cy5kb3duID0gZnVuY3Rpb24oa25leCwgUHJvbWlzZSkge1xuICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgIGtuZXguc2NoZW1hLmRyb3BUYWJsZSgnbGlzdGVuX2RhdGUnKSxcbiAgICBrbmV4LnNjaGVtYS5kcm9wVGFibGUoJ2FsYnVtX2ltcHJlc3Npb24nKSxcbiAgICBrbmV4LnNjaGVtYS5kcm9wVGFibGUoJ3NvbmcnKSxcbiAgICBrbmV4LnNjaGVtYS5kcm9wVGFibGUoJ2FsYnVtJyksXG4gICAga25leC5zY2hlbWEuZHJvcFRhYmxlKCdhcnRpc3QnKSxcbiAgICBrbmV4LnNjaGVtYS5kcm9wVGFibGUoJ3VzZXJzJylcbiAgXSk7XG59O1xuIl19